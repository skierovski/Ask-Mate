{% extends 'base.html' %}

{% block content %}

    <div class="title">
        <h1>{% block title %}Question details{% endblock %}</h1>

        <a href="/list" class="user_button"> All question list</a>
    </div>
        <br><br>


        <div class="list-box">
            <div class="flex-container">
                <div class="flex-items">
                    <div class="question-statistic">
                         <p>
                             <span class="static_value"> {{ selected_question[0].view_number }}</span>
                             <span class="static_txt"> question views</span>
                         </p>
                        <p>
                            <span class="static_value">{{ selected_question[0].vote_number }}</span>
                            <span class="static_txt"> question votes</span>
                        </p>
                    </div>
                {% if is_log_in %}
                    <div class="question-image">
                            {% if ( selected_question[0].user_id ) == user_id %}
                                <a href="/question/{{ selected_question[0].id }}/delete" class="user_button"> Delete question</a><br><br>
                                <a href="/question/{{ selected_question[0].id }}/edit" class="user_button"> Edit question</a><br><br>
                            {% endif %}
                                <a href="/question/{{ selected_question[0].id }}/new-comment" class="user_button"> Add comment</a><br><br>
                    </div>
                {% endif %}

                </div>
                <div class="flex-items">
                    <div class="question-details">
                        <p class="question-title">{{ selected_question[0].title }}</p>
                        <p class="question-tag">Tags:
                        {% if is_log_in %}
                            {% if ( selected_question[0].user_id ) == user_id %}
                                {% if selected_question_tag|length == 0 %}
                                    <a href="/question/{{ selected_question[0].id }}/new-tag" class="title"><i class="fa-solid fa-plus"></i></a>
                                {% else %}
                                    <a href="/question/{{ selected_question[0].id }}/new-tag" class="title"><i class="fa-solid fa-plus"></i></a>
                                    <a href="/question/{{ selected_question[0].id }}/delete-tag" class="title"><i class="fa-solid fa-minus"></i></a>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                            {% if selected_question_tag|length == 0 %}
                                No Tags
                            {% else %}
                                {% for tag in selected_question_tag %}
                                    {{ tag.name }}
                                {% endfor %}
                            {% endif %}</p>
                       {% autoescape false %} <p class="question-message">{{ selected_question[0].message }}</p>{% endautoescape %}
                    </div>
                </div>
            </div>
            <div class="question-footer" >
                <spam class="static_txt">Published: </spam>
                <spam class="static_value">{{ selected_question[0].submission_time.strftime('%d-%m-%Y %H:%M:%S')}} </spam>
                <spam class="static_txt"> <i class="fa-solid fa-user"></i> </spam>
                <spam class="static_value">{{ selected_question[0].author }}</spam>
            </div>
        <br>
            <div class="question-footer" style="color: white">
                <b>Question comment:</b>
            </div><br>
            {% for row in selected_question_comments %}
                  <div class="question-footer">
                            <spam class="static_txt">Published: </spam><spam class="static_value"> {{ row.submission_time.strftime('%d-%m-%Y %H:%M:%S') }}
                        {% if row.edited_count == 0 %}
                            <spam class="static_txt"><i class="fa-solid fa-user"></i></spam> {{ row.author }}
                        {% else %}
                            <spam class="static_txt"><i class="fa-solid fa-user-pen"></i></spam> Edited {{ row.edited_count }} times by {{ row.author }}.</spam>
                        {% endif %}
                <br><br><spam class="static_value">{% autoescape false %}{{ row.message }}
{% endautoescape %}</spam><br><br>
                        {% if is_log_in %}
                            {% if ( row.user_id ) == user_id %}
                                <a href="/comment/{{ row.id }}/edit" class="user_button">Edit comment</a>
                                <a href="/comments/{{ row.id }}/delete" class="user_button" onclick="return confirm('Are you sure you want to delete this comment?')"> Delete comment</a><br>
                            {% endif %}
                        {% endif %}
                  </div>
                <br>
                {% endfor %}<br>
        </div>
    <h1>Answer</h1>
        {% if is_log_in and ( selected_question[0].user_id ) != user_id%}
            <a href="/question/{{ selected_question[0].id }}/new-answer" class="user_button"> Add answer</a><br><br>
        {% endif %}


    {% for row in selected_answer %}
        <div class="list-box">
                <div class="flex-container">
                    <div class="flex-items">
                        <div class="question-statistic"><span class="static_value">
                             {% if is_log_in %}
                                <a href="/answer/{{ row.id }}/vote-down" class="down"><i class="fa-solid fa-hand-point-down"></i></a>
                            {% endif %}
                                    {{ row.vote_number }}
                            {% if is_log_in %}
                                <a href="/answer/{{ row.id }}/vote-up" class="up"><i class="fa-solid fa-hand-point-up"></i></a>
                            {% endif %}
                        </span><span class="static_txt"> answer votes</span></p>
                        </div>
                        {% if not is_log_in %}
                            {% if row.accepted ==1 %}
                                <div class="question-image">
                                    <a href="/login" class="user_button" style="background-color:#F93A0B"><i class="fa-solid fa-check"></i></a><br><br>
                            {% elif row.accepted == 0 %}
                                <div class="question-image">
                                    <a href="/login" class="user_button"><i class="fa-solid fa-check"></i></a><br><br>
                            {% endif %}
                        {% endif %}
                        {% if is_log_in %}
                            <div class="question-image">
                                {% if row.accepted == 1 and ( selected_question[0].user_id ) != user_id  %}
                                    <a href="/question/{{ selected_question[0].id }}" class="user_button" style="background-color:#F93A0B"><i class="fa-solid fa-check"></i></a><br><br>
                                {%  endif %}
                                {% if row.accepted == 0 and ( selected_question[0].user_id ) != user_id %}
                                    <a href="/question/{{ selected_question[0].id }}" class="user_button"><i class="fa-solid fa-check"></i></a><br><br>
                                {%  endif %}
                                {% if ( row.user_id ) == user_id %}
                                    <a href="/answer/{{ row.id }}/new-comment" class="user_button">Add answer comment</a><br><br>
                                {% endif %}
                                {% if ( selected_question[0].user_id ) != user_id and ( row.user_id ) == user_id %}
                                    <a href="/answer/{{ row.id }}/delete" class="user_button">Delete answer</a><br><br>
                                    <a href="/answer/{{ row.id }}/edit" class="user_button"> Edit answer</a><br><br>
                                {% endif %}
                                {% if selected_question[0].user_id == user_id and row.accepted == 1 %}
                                    <a href="/answer/{{ row.id }}/declined" class="user_button" style="background-color:#F93A0B"><i class="fa-solid fa-check"></i></a><br><br>
                                {% elif selected_question[0].user_id == user_id and row.accepted == 0 %}
                                    <a href="/answer/{{ row.id }}/accept" class="user_button"><i class="fa-solid fa-check"></i></a><br><br>
                                {% endif %}
                        {% endif %}
                            </div>
                    </div>
                    <div class="flex-items">
                        <div class="question-details">
                            {% autoescape false %} <p class="question-message">{{ row.message }}</p>{% endautoescape %}
                        </div>
                    </div>
                </div>
                <div class="question-footer" >
                    <spam class="static_txt">Published: </spam><spam class="static_value">{{ row.submission_time.strftime('%d-%m-%Y %H:%M:%S')}} </spam>
                    <spam class="static_txt"> <i class="fa-solid fa-user"></i> </spam><spam class="static_value">{{ row.author }}</spam>

                </div><br>
                <div class="question-footer" style="color: white">
                    <b>Answer comments:</b>
                </div><br>
        </div>
    {% endfor %}
<br><br>
{% endblock %}